(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{663:function(e,t,o){"use strict";o.r(t);o(65);var r={props:{userInfo:{type:Object,default:function(){return{username:"",email:"",mobilePhoneNumber:"",bio:""}}}},data:function(){return{}},methods:{updateProfile:function(){var e=this,t=this.userInfo,o=t.bio,r=t.mobilePhoneNumber;this.$axios.put("users/"+this.userInfo.objectId,{bio:o,mobilePhoneNumber:r}).then((function(t){200===t.status?e.$message({type:"success",message:"Profile updated successfully."}):e.$message.error(t.data.info)}),(function(t){e.$message({type:"error",message:t.response.data.error})}))}}},n=o(27),l=Object(n.a)(r,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"userInfoForm",attrs:{model:e.userInfo,"label-position":"left"}},[o("el-form-item",{attrs:{label:"Username"}},[o("el-input",{attrs:{disabled:""},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Email"}},[o("el-input",{attrs:{disabled:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Phone"}},[o("el-input",{model:{value:e.userInfo.mobilePhoneNumber,callback:function(t){e.$set(e.userInfo,"mobilePhoneNumber",t)},expression:"userInfo.mobilePhoneNumber"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Bio"}},[o("el-input",{attrs:{type:"textarea",placeholder:"Tell us a little bit about yourself."},model:{value:e.userInfo.bio,callback:function(t){e.$set(e.userInfo,"bio",t)},expression:"userInfo.bio"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Created At"}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",disabled:""},model:{value:e.userInfo.createdAt,callback:function(t){e.$set(e.userInfo,"createdAt",t)},expression:"userInfo.createdAt"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.updateProfile}},[e._v("Update profile")])],1)],1)}),[],!1,null,null,null).exports,d={data:function(){var e=this;return{updatePasswordForm:{old_password:"",new_password:"",check_new_password:""},rule:{old_password:[{validator:function(t,o,r){""===o?r(new Error("Please input old password")):(""!==e.updatePasswordForm.new_password&&e.$refs.updatePasswordForm.validateField("new_password"),r())},trigger:"blur"}],new_password:[{validator:function(t,o,r){""===o?r(new Error("Please input new password")):o===e.updatePasswordForm.old_password?r(new Error("The two passwords can not be same!")):r()},trigger:"blur"}],check_new_password:[{validator:function(t,o,r){""===o?r(new Error("Please input new password again")):o!==e.updatePasswordForm.new_password?r(new Error("The two passwords do not match!")):r()},trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.updatePassword()}))},updatePassword:function(){var e=this,t=this.updatePasswordForm,o=t.old_password,r=t.new_password;this.$axios.put("users/"+this.$store.state.objectId+"/updatePassword",{old_password:o,new_password:r}).then((function(t){200===t.status?(e.$message({type:"success",message:"Password updated successfully.<br><br>Please login again.",dangerouslyUseHTMLString:!0}),e.$store.dispatch("logout"),e.$router.push("/login")):e.$message.error(t.data.info)}),(function(t){e.$message({type:"error",message:t.response.data.error})}))}}},c=Object(n.a)(d,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"updatePasswordForm",attrs:{model:e.updatePasswordForm,rules:e.rule,"label-position":"top"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitForm("updatePasswordForm")}}},[o("el-form-item",{attrs:{prop:"old_password",label:"Old password"}},[o("el-input",{attrs:{type:"password"},model:{value:e.updatePasswordForm.old_password,callback:function(t){e.$set(e.updatePasswordForm,"old_password",t)},expression:"updatePasswordForm.old_password"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"new_password",label:"New password"}},[o("el-input",{attrs:{type:"password"},model:{value:e.updatePasswordForm.new_password,callback:function(t){e.$set(e.updatePasswordForm,"new_password",t)},expression:"updatePasswordForm.new_password"}})],1),e._v(" "),o("el-form-item",{attrs:{prop:"check_new_password",label:"Confirm new password"}},[o("el-input",{attrs:{type:"password"},model:{value:e.updatePasswordForm.check_new_password,callback:function(t){e.$set(e.updatePasswordForm,"check_new_password",t)},expression:"updatePasswordForm.check_new_password"}})],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("updatePasswordForm")}}},[e._v("Update password")])],1)],1)}),[],!1,null,null,null).exports,m={props:{userInfo:{type:Object,default:function(){return{authData:{github:{}}}}}},data:function(){return{accountData:[{account:"github",icon:"#icon-github",name:"GitHub",oauth_path:"https://github.com/login/oauth/authorize"}]}},methods:{connectAccount:function(e,t){window.open(this.accountData[e].oauth_path+"?client_id=52583d9434cbb792037c&scope="+["user:email"],"_self")},disconnectAccount:function(e,t){var o=this,r={};r["authData."+t.account]={__op:"Delete"},this.$axios.put("users/"+this.$store.state.objectId,r).then((function(e){o.$message({type:"success",message:"Disconnected successfully."}),o.$set(o.userInfo.authData,t.account,void 0)})).catch((function(e){o.$message({type:"error",message:e.response.data.error})}))}}},f={components:{UserInfo:l,UpdatePassword:c,ThirdOAuth:Object(n.a)(m,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.accountData}},[o("el-table-column",{attrs:{prop:"name",label:"第三方账号关联"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("svg",{staticClass:"icon",staticStyle:{width:"1.2em",height:"1.2em"},attrs:{"aria-hidden":"true"}},[o("use",{attrs:{"xlink:href":t.row.icon}})]),e._v("\n      "+e._s(t.row.name)+"\n    ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-tag",{attrs:{type:void 0===e.userInfo.authData[t.row.account]?"danger":"success",size:"small"}},[e._v(e._s(void 0===e.userInfo.authData[t.row.account]?"Not":"")+"  Connected")])]}}])}),e._v(" "),o("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0===e.userInfo.authData[t.row.account]?[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){return e.connectAccount(t.$index,t.row)}}},[e._v("Connect")])]:[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){return e.disconnectAccount(t.$index,t.row)}}},[e._v("Disconnect")])]]}}])})],1)}),[],!1,null,null,null).exports},data:function(){return{tab:"userInfo",tabPosition:"left",tabItems:[{index:"userInfo",label:"用户信息",component:"UserInfo"},{index:"updatePassword",label:"修改密码",component:"UpdatePassword"},{index:"thirdOAuth",label:"第三方账户",component:"ThirdOAuth"}],userInfo:{authData:{}}}},beforeCreate:function(){var e=this;this.$axios.get("users/me").then((function(t){200===t.status?(e.userInfo=t.data,void 0!==e.userInfo.authData&&null!==e.userInfo.authData||(e.userInfo.authData={})):e.$message.error(t.data.info)}),(function(t){e.$message({type:"error",message:t.response.data.error})}))},created:function(){this.$route.query.tab&&(this.tab=this.$route.query.tab)}},w=Object(n.a)(f,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-tabs",{attrs:{"tab-position":e.tabPosition,value:e.tab}},e._l(e.tabItems,(function(t){return o("el-tab-pane",{key:t.index,attrs:{label:t.label,name:t.index}},[o("el-row",[o("el-col",{attrs:{xs:24,sm:{span:12,offset:6}}},[o(t.component,{tag:"component",attrs:{"user-info":e.userInfo}})],1)],1)],1)})),1)}),[],!1,null,"02384094",null);t.default=w.exports}}]);